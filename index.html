<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drone Flight Advisor PRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --warning: #f72585;
            --danger: #7209b7;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --bg-gradient: linear-gradient(135deg, #1a2980, #26d0ce);
            --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            --border-radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background: var(--bg-gradient);
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
            font-size: 14px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        header h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        header p {
            font-size: 0.95rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.5;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        @media (max-width: 768px) {
            body { padding: 15px; }
            .main-content { grid-template-columns: 1fr; gap: 20px; }
            header h1 { font-size: 1.7rem; }
        }

        .card {
            background: rgba(255, 255, 255, 0.97);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--secondary);
            padding-bottom: 12px;
            border-bottom: 2px solid var(--success);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i { color: var(--primary); }

        .form-group { margin-bottom: 18px; }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }

        .input-with-icon { position: relative; }

        .input-with-icon i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        select, input {
            width: 100%;
            padding: 14px 15px 14px 45px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 0.95rem;
            transition: all 0.3s;
            background: white;
        }

        select:focus, input:focus {
            border-color: var(--success);
            outline: none;
            box-shadow: 0 0 0 3px rgba(38, 208, 206, 0.2);
        }

        .datetime-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: linear-gradient(to right, #6c757d, #495057);
            margin-top: 5px;
        }

        .btn-success {
            background: linear-gradient(to right, #28a745, #20c997);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .favorite-btn {
            background: none;
            border: none;
            color: #ffc107;
            font-size: 1.5rem;
            cursor: pointer;
            margin-left: 10px;
        }

        .favorite-btn.active { color: #ffc107; }

        .weather-result { margin-top: 20px; display: none; }

        .flight-status {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .status-excellent { background: linear-gradient(135deg, #00b09b, #96c93d); }
        .status-good { background: linear-gradient(135deg, #11998e, #38ef7d); }
        .status-moderate { background: linear-gradient(135deg, #f7971e, #ffd200); }
        .status-poor { background: linear-gradient(135deg, #ff416c, #ff4b2b); }
        .status-bad { background: linear-gradient(135deg, #8e2de2, #4a00e0); }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
        }

        .weather-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border: 1px solid #f1f3f5;
        }

        .weather-icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .weather-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--secondary);
        }

        .weather-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }

        .conditions-list {
            list-style: none;
        }

        .conditions-list li {
            padding: 12px 0;
            border-bottom: 1px solid #f1f3f5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .conditions-list li:last-child { border-bottom: none; }

        .condition-status {
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            min-width: 70px;
            text-align: center;
        }

        .condition-good { background-color: #d4edda; color: #155724; }
        .condition-warning { background-color: #fff3cd; color: #856404; }
        .condition-bad { background-color: #f8d7da; color: #721c24; }

        .loading {
            text-align: center;
            padding: 40px 20px;
            display: none;
        }

        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--success);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-result {
            text-align: center;
            padding: 50px 20px;
            color: var(--gray);
        }

        .no-result i {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #e9ecef;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            color: white;
            opacity: 0.8;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        .tab-nav { display: none; }

        @media (max-width: 768px) {
            .tab-nav {
                display: flex;
                background: white;
                border-radius: 12px;
                overflow: hidden;
                margin-bottom: 20px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            }
            .tab-btn {
                flex: 1;
                padding: 15px;
                text-align: center;
                background: none;
                border: none;
                font-weight: 600;
                color: var(--gray);
                cursor: pointer;
                transition: all 0.3s;
            }
            .tab-btn.active {
                color: var(--primary);
                background: rgba(67, 97, 238, 0.1);
            }
            .tab-content { display: none; }
            .tab-content.active { display: block; }
        }

        @media (max-width: 480px) {
            .card { padding: 20px 15px; }
            .section-title { font-size: 1.2rem; }
            .datetime-group { grid-template-columns: 1fr; gap: 12px; }
            .weather-details { grid-template-columns: repeat(2, 1fr); }
        }

        .autocomplete-container { position: relative; }

        .autocomplete-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 0 0 10px 10px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .autocomplete-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f1f3f5;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .autocomplete-item:hover { background-color: #f8f9fa; }

        .autocomplete-item i { color: var(--primary); }

        .city-name { font-weight: 500; }

        .country-name {
            font-size: 0.85rem;
            color: var(--gray);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-drone"></i> Drone Flight Advisor PRO</h1>
            <p>Профессиональный анализ погодных условий для безопасных полетов дронов</p>
        </header>

        <div class="tab-nav">
            <button class="tab-btn active" data-tab="settings"><i class="fas fa-sliders-h"></i> Настройки</button>
            <button class="tab-btn" data-tab="results"><i class="fas fa-chart-line"></i> Результаты</button>
        </div>

        <div class="main-content">
            <section class="card tab-content active" id="settings-tab">
                <h2 class="section-title"><i class="fas fa-sliders-h"></i> Настройки полета</h2>

                <div class="form-group">
                    <label for="droneModel"><i class="fas fa-robot"></i> Модель дрона</label>
                    <div style="display: flex; align-items: center;">
                        <select id="droneModel" style="flex: 1; padding-right: 50px;">
                            <!-- Группы будут заполнены JavaScript -->
                        </select>
                        <button class="favorite-btn" id="toggleFavorite" title="Добавить в избранное">
                            <i class="far fa-star"></i>
                        </button>
                    </div>
                </div>

                <button class="btn btn-secondary" id="addCustomDroneBtn">
                    <i class="fas fa-plus-circle"></i> Добавить свой дрон
                </button>

                <div class="form-group">
                    <label for="location"><i class="fas fa-map-marker-alt"></i> Местоположение</label>
                    <div class="autocomplete-container">
                        <div class="input-with-icon">
                            <i class="fas fa-search-location"></i>
                            <input type="text" id="location" placeholder="Начните вводить город..." autocomplete="off">
                        </div>
                        <div class="autocomplete-results" id="autocompleteResults"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-calendar-alt"></i> Временной промежуток</label>
                    <div class="datetime-group">
                        <div>
                            <label for="date">Дата</label>
                            <div class="input-with-icon">
                                <i class="fas fa-calendar"></i>
                                <input type="date" id="date">
                            </div>
                        </div>
                        <div>
                            <label for="time">Время</label>
                            <div class="input-with-icon">
                                <i class="fas fa-clock"></i>
                                <input type="time" id="time">
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn" id="checkWeather">
                    <i class="fas fa-cloud-sun"></i> Анализировать условия полета
                </button>

                <div class="form-group" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <h3 style="font-size: 1rem; margin-bottom: 10px; color: var(--primary);">
                        <i class="fas fa-info-circle"></i> Характеристики выбранного дрона:
                    </h3>
                    <div id="selectedDroneInfo">
                        <strong id="selectedDroneName">DJI Mini 3 Pro</strong>
                        <div id="droneSpecs" style="font-size: 0.85rem; color: var(--gray); margin-top: 5px;">
                            Макс. ветер: 10.7 м/с | Дождь: Нет | Температура: 0°C до 40°C | Видимость: 1000 м
                        </div>
                    </div>
                </div>
            </section>

            <section class="card tab-content" id="results-tab">
                <h2 class="section-title"><i class="fas fa-chart-line"></i> Результаты анализа</h2>

                <div class="loading" id="loading">
                    <div class="loading-spinner"></div>
                    <p>Получаем данные о погоде...</p>
                </div>

                <div class="weather-result" id="weatherResult">
                    <div class="flight-status" id="flightStatus"></div>

                    <div class="weather-details" id="weatherDetails"></div>

                    <h3 class="section-title"><i class="fas fa-clipboard-check"></i> Условия для полета</h3>
                    <ul class="conditions-list" id="conditionsList"></ul>

                    <div class="form-group" style="margin-top: 25px; padding: 15px; background: #e3f2fd; border-radius: 10px;">
                        <h4 style="font-size: 0.95rem; margin-bottom: 8px; color: #1565c0;">
                            <i class="fas fa-lightbulb"></i> Рекомендации:
                        </h4>
                        <div id="recommendations" style="font-size: 0.85rem; color: #0d47a1;"></div>
                    </div>
                </div>

                <div class="no-result" id="noResult">
                    <i class="fas fa-cloud"></i>
                    <p>Настройте параметры полета и нажмите "Анализировать условия полета" для получения результатов.</p>
                </div>
            </section>
        </div>

        <footer>
            <p>Drone Flight Advisor PRO v3.0 | Данные о погоде предоставляются OpenWeatherMap</p>
            <p>Всегда соблюдайте местные законы и правила при полетах на дронах</p>
        </footer>
    </div>

    <!-- Модальное окно для добавления своего дрона -->
    <div class="modal" id="customDroneModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="color: var(--primary);"><i class="fas fa-plus-circle"></i> Добавить свой дрон</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <form id="customDroneForm">
                <div class="form-group">
                    <label for="customName">Название дрона</label>
                    <input type="text" id="customName" required>
                </div>
                <div class="form-group">
                    <label for="customMaxWind">Макс. скорость ветра (м/с)</label>
                    <input type="number" id="customMaxWind" step="0.1" required>
                </div>
                <div class="form-group">
                    <label for="customRainAllowed">Допустимость дождя</label>
                    <select id="customRainAllowed" required>
                        <option value="false">Нет</option>
                        <option value="true">Да</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="customMinTemp">Минимальная температура (°C)</label>
                    <input type="number" id="customMinTemp" required>
                </div>
                <div class="form-group">
                    <label for="customMaxTemp">Максимальная температура (°C)</label>
                    <input type="number" id="customMaxTemp" required>
                </div>
                <div class="form-group">
                    <label for="customMinVisibility">Минимальная видимость (метры)</label>
                    <input type="number" id="customMinVisibility" value="1000" required>
                </div>
                <div class="form-group">
                    <label for="customWindWarning">Порог предупреждения по ветру (м/с)</label>
                    <input type="number" id="customWindWarning" step="0.1" required>
                </div>
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> Сохранить дрон
                </button>
            </form>
        </div>
    </div>

    <script>
        // API ключ (замените на свой, если нужно)
        const API_KEY = 'f3843336b2145e67e0c0614fb8585cc1'; // Ключ, предоставленный пользователем

        // База данных дронов (реальные характеристики)
        const drones = [
            // DJI
            { id: "dji_mini_3", name: "DJI Mini 3 Pro", brand: "DJI", category: "Легкие", maxWind: 10.7, rainAllowed: false, minTemp: 0, maxTemp: 40, minVisibility: 1000, windWarning: 8 },
            { id: "dji_mini_4", name: "DJI Mini 4 Pro", brand: "DJI", category: "Легкие", maxWind: 10.7, rainAllowed: false, minTemp: -10, maxTemp: 40, minVisibility: 1000, windWarning: 8 },
            { id: "dji_mavic_3", name: "DJI Mavic 3", brand: "DJI", category: "Профессиональные", maxWind: 12, rainAllowed: false, minTemp: -10, maxTemp: 40, minVisibility: 500, windWarning: 10 },
            { id: "dji_air_3", name: "DJI Air 3", brand: "DJI", category: "Продвинутые", maxWind: 12, rainAllowed: false, minTemp: -10, maxTemp: 40, minVisibility: 800, windWarning: 10 },
            { id: "dji_phantom_4", name: "DJI Phantom 4 Pro", brand: "DJI", category: "Профессиональные", maxWind: 10, rainAllowed: false, minTemp: 0, maxTemp: 40, minVisibility: 1000, windWarning: 8 },
            { id: "dji_fpv", name: "DJI FPV", brand: "DJI", category: "FPV", maxWind: 12, rainAllowed: false, minTemp: -10, maxTemp: 40, minVisibility: 2000, windWarning: 10 },
            { id: "dji_avata", name: "DJI Avata", brand: "DJI", category: "FPV", maxWind: 10.7, rainAllowed: false, minTemp: 0, maxTemp: 40, minVisibility: 1000, windWarning: 8 },
            // Autel
            { id: "autel_nano", name: "Autel Evo Nano+", brand: "Autel", category: "Легкие", maxWind: 10, rainAllowed: false, minTemp: -10, maxTemp: 40, minVisibility: 1000, windWarning: 8 },
            { id: "autel_lite", name: "Autel Evo Lite+", brand: "Autel", category: "Продвинутые", maxWind: 10, rainAllowed: false, minTemp: -5, maxTemp: 40, minVisibility: 800, windWarning: 8 },
            // Skydio
            { id: "skydio_2", name: "Skydio 2+", brand: "Skydio", category: "Автономные", maxWind: 11, rainAllowed: false, minTemp: -5, maxTemp: 40, minVisibility: 1000, windWarning: 9 },
            // Parrot
            { id: "parrot_anafi", name: "Parrot Anafi USA", brand: "Parrot", category: "Правительственные", maxWind: 13, rainAllowed: false, minTemp: -10, maxTemp: 40, minVisibility: 1000, windWarning: 11 },
            // Freefly
            { id: "freefly_alta", name: "Freefly Alta X", brand: "Freefly", category: "Кинематографические", maxWind: 13, rainAllowed: false, minTemp: -10, maxTemp: 40, minVisibility: 500, windWarning: 10 },
            // Yuneec
            { id: "yuneec_h520", name: "Yuneec H520", brand: "Yuneec", category: "Промышленные", maxWind: 10, rainAllowed: true, minTemp: -10, maxTemp: 40, minVisibility: 500, windWarning: 8 },
            // PowerVision
            { id: "poweregg_x", name: "PowerEgg X", brand: "PowerVision", category: "Мультифункциональные", maxWind: 10, rainAllowed: false, minTemp: 0, maxTemp: 40, minVisibility: 1000, windWarning: 8 },
            // Hubsan
            { id: "hubsan_zino", name: "Hubsan Zino 2", brand: "Hubsan", category: "Бюджетные", maxWind: 8, rainAllowed: false, minTemp: 0, maxTemp: 40, minVisibility: 1000, windWarning: 6 },
            // FIMI
            { id: "fimi_x8", name: "FIMI X8 SE", brand: "FIMI", category: "Бюджетные", maxWind: 8, rainAllowed: false, minTemp: 0, maxTemp: 40, minVisibility: 1000, windWarning: 6 },
            // Eachine
            { id: "eachine_ex5", name: "Eachine EX5", brand: "Eachine", category: "Начинающие", maxWind: 6, rainAllowed: false, minTemp: 0, maxTemp: 35, minVisibility: 1500, windWarning: 4 },
            // Custom (пример)
            { id: "custom_fpv", name: "Кастомный FPV", brand: "Custom", category: "FPV", maxWind: 15, rainAllowed: false, minTemp: -5, maxTemp: 40, minVisibility: 2000, windWarning: 12 }
        ];

        // Избранные дроны (загружаются из localStorage)
        let favoriteDrones = JSON.parse(localStorage.getItem('favoriteDrones')) || [];

        // Текущий выбранный дрон
        let selectedDrone = drones[0];

        // Текущие координаты (по умолчанию Москва)
        let selectedCoords = { lat: 55.7558, lon: 37.6173, name: "Москва, Россия" };

        // Элементы DOM
        const droneModelSelect = document.getElementById('droneModel');
        const toggleFavoriteBtn = document.getElementById('toggleFavorite');
        const addCustomDroneBtn = document.getElementById('addCustomDroneBtn');
        const customDroneModal = document.getElementById('customDroneModal');
        const closeModalBtn = document.getElementById('closeModal');
        const customDroneForm = document.getElementById('customDroneForm');
        const locationInput = document.getElementById('location');
        const autocompleteResults = document.getElementById('autocompleteResults');
        const dateInput = document.getElementById('date');
        const timeInput = document.getElementById('time');
        const checkWeatherBtn = document.getElementById('checkWeather');
        const selectedDroneName = document.getElementById('selectedDroneName');
        const droneSpecs = document.getElementById('droneSpecs');
        const loadingElement = document.getElementById('loading');
        const weatherResult = document.getElementById('weatherResult');
        const noResultElement = document.getElementById('noResult');
        const flightStatus = document.getElementById('flightStatus');
        const weatherDetails = document.getElementById('weatherDetails');
        const conditionsList = document.getElementById('conditionsList');
        const recommendationsElement = document.getElementById('recommendations');
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        // Установка текущей даты и времени
        function setCurrentDateTime() {
            const now = new Date();
            const dateString = now.toISOString().split('T')[0];
            const timeString = now.getHours().toString().padStart(2, '0') + ':' +
                              now.getMinutes().toString().padStart(2, '0');

            dateInput.value = dateString;
            timeInput.value = timeString;

            dateInput.min = dateString;
            const maxDate = new Date();
            maxDate.setDate(now.getDate() + 5);
            dateInput.max = maxDate.toISOString().split('T')[0];
        }

        // Инициализация выпадающего списка дронов
        function initDroneSelect() {
            droneModelSelect.innerHTML = '';

            // Группировка дронов по категориям
            const categories = {};
            drones.forEach(drone => {
                if (!categories[drone.category]) {
                    categories[drone.category] = [];
                }
                categories[drone.category].push(drone);
            });

            // Добавление избранных дронов в отдельную группу
            if (favoriteDrones.length > 0) {
                const favGroup = document.createElement('optgroup');
                favGroup.label = '⭐ Избранные';
                favoriteDrones.forEach(favId => {
                    const drone = drones.find(d => d.id === favId);
                    if (drone) {
                        const option = document.createElement('option');
                        option.value = drone.id;
                        option.textContent = drone.name;
                        favGroup.appendChild(option);
                    }
                });
                droneModelSelect.appendChild(favGroup);
            }

            // Добавление остальных категорий
            for (const [category, droneList] of Object.entries(categories)) {
                const optgroup = document.createElement('optgroup');
                optgroup.label = category;
                droneList.forEach(drone => {
                    // Пропускаем дроны, которые уже в избранном
                    if (favoriteDrones.includes(drone.id)) return;

                    const option = document.createElement('option');
                    option.value = drone.id;
                    option.textContent = drone.name;
                    optgroup.appendChild(option);
                });
                if (optgroup.children.length > 0) {
                    droneModelSelect.appendChild(optgroup);
                }
            }

            // Установка выбранного дрона
            droneModelSelect.value = selectedDrone.id;
            updateSelectedDroneInfo();
            updateFavoriteButton();
        }

        // Обновление информации о выбранном дроне
        function updateSelectedDroneInfo() {
            selectedDroneName.textContent = selectedDrone.name;
            droneSpecs.innerHTML = `
                Макс. ветер: <strong>${selectedDrone.maxWind} м/с</strong> |
                Дождь: <strong>${selectedDrone.rainAllowed ? 'Да' : 'Нет'}</strong> |
                Температура: <strong>${selectedDrone.minTemp}°C до ${selectedDrone.maxTemp}°C</strong> |
                Видимость: <strong>${selectedDrone.minVisibility} м</strong>
            `;
        }

        // Обновление кнопки избранного
        function updateFavoriteButton() {
            const isFavorite = favoriteDrones.includes(selectedDrone.id);
            toggleFavoriteBtn.innerHTML = isFavorite
                ? '<i class="fas fa-star"></i>'
                : '<i class="far fa-star"></i>';
            toggleFavoriteBtn.title = isFavorite
                ? 'Удалить из избранного'
                : 'Добавить в избранное';
        }

        // Добавление/удаление из избранного
        toggleFavoriteBtn.addEventListener('click', () => {
            const index = favoriteDrones.indexOf(selectedDrone.id);
            if (index === -1) {
                favoriteDrones.push(selectedDrone.id);
            } else {
                favoriteDrones.splice(index, 1);
            }
            localStorage.setItem('favoriteDrones', JSON.stringify(favoriteDrones));
            updateFavoriteButton();
            initDroneSelect(); // Перестраиваем список
        });

        // Обработчик выбора дрона
        droneModelSelect.addEventListener('change', () => {
            const droneId = droneModelSelect.value;
            selectedDrone = drones.find(d => d.id === droneId) || drones[0];
            updateSelectedDroneInfo();
            updateFavoriteButton();
        });

        // Модальное окно для добавления своего дрона
        addCustomDroneBtn.addEventListener('click', () => {
            customDroneModal.style.display = 'flex';
        });

        closeModalBtn.addEventListener('click', () => {
            customDroneModal.style.display = 'none';
        });

        customDroneForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const customDrone = {
                id: 'custom_' + Date.now(),
                name: document.getElementById('customName').value,
                brand: 'Пользовательский',
                category: 'Пользовательские',
                maxWind: parseFloat(document.getElementById('customMaxWind').value),
                rainAllowed: document.getElementById('customRainAllowed').value === 'true',
                minTemp: parseInt(document.getElementById('customMinTemp').value),
                maxTemp: parseInt(document.getElementById('customMaxTemp').value),
                minVisibility: parseInt(document.getElementById('customMinVisibility').value),
                windWarning: parseFloat(document.getElementById('customWindWarning').value)
            };

            drones.push(customDrone);
            selectedDrone = customDrone;
            initDroneSelect();
            customDroneModal.style.display = 'none';
            customDroneForm.reset();

            alert('Дрон успешно добавлен!');
        });

        // База данных городов (расширенная)
        const cities = [
            // Россия
            { name: "Москва", country: "Россия", lat: 55.7558, lon: 37.6173 },
            { name: "Санкт-Петербург", country: "Россия", lat: 59.9343, lon: 30.3351 },
            { name: "Новосибирск", country: "Россия", lat: 55.0084, lon: 82.9357 },
            { name: "Екатеринбург", country: "Россия", lat: 56.8389, lon: 60.6057 },
            { name: "Казань", country: "Россия", lat: 55.8304, lon: 49.0661 },
            { name: "Нижний Новгород", country: "Россия", lat: 56.2965, lon: 43.9361 },
            { name: "Челябинск", country: "Россия", lat: 55.1644, lon: 61.4368 },
            { name: "Самара", country: "Россия", lat: 53.2415, lon: 50.2212 },
            { name: "Омск", country: "Россия", lat: 54.9885, lon: 73.3242 },
            { name: "Ростов-на-Дону", country: "Россия", lat: 47.2357, lon: 39.7015 },
            { name: "Уфа", country: "Россия", lat: 54.7355, lon: 55.9917 },
            { name: "Красноярск", country: "Россия", lat: 56.0153, lon: 92.8932 },
            { name: "Воронеж", country: "Россия", lat: 51.672, lon: 39.1843 },
            { name: "Пермь", country: "Россия", lat: 58.0105, lon: 56.2294 },
            { name: "Волгоград", country: "Россия", lat: 48.708, lon: 44.5133 },
            { name: "Краснодар", country: "Россия", lat: 45.0355, lon: 38.9753 },
            { name: "Саратов", country: "Россия", lat: 51.5924, lon: 45.9608 },
            { name: "Тюмень", country: "Россия", lat: 57.153, lon: 65.5343 },
            { name: "Тольятти", country: "Россия", lat: 53.5088, lon: 49.4191 },
            { name: "Ижевск", country: "Россия", lat: 56.8527, lon: 53.2115 },
            { name: "Барнаул", country: "Россия", lat: 53.3606, lon: 83.7636 },
            { name: "Ульяновск", country: "Россия", lat: 54.3142, lon: 48.4031 },
            { name: "Иркутск", country: "Россия", lat: 52.2864, lon: 104.2807 },
            { name: "Хабаровск", country: "Россия", lat: 48.4827, lon: 135.0839 },
            { name: "Ярославль", country: "Россия", lat: 57.6261, lon: 39.8845 },
            { name: "Владивосток", country: "Россия", lat: 43.1198, lon: 131.8869 },
            { name: "Махачкала", country: "Россия", lat: 42.9849, lon: 47.5047 },
            { name: "Томск", country: "Россия", lat: 56.4846, lon: 84.9476 },
            { name: "Оренбург", country: "Россия", lat: 51.7682, lon: 55.0969 },
            { name: "Кемерово", country: "Россия", lat: 55.3547, lon: 86.0878 },
            { name: "Новокузнецк", country: "Россия", lat: 53.7576, lon: 87.136 },
            { name: "Рязань", country: "Россия", lat: 54.629, lon: 39.7419 },
            { name: "Астрахань", country: "Россия", lat: 46.3479, lon: 48.0336 },
            { name: "Набережные Челны", country: "Россия", lat: 55.7436, lon: 52.3959 },
            { name: "Пенза", country: "Россия", lat: 53.2007, lon: 45.0046 },
            { name: "Липецк", country: "Россия", lat: 52.6088, lon: 39.5992 },
            { name: "Киров", country: "Россия", lat: 58.6036, lon: 49.668 },
            { name: "Чебоксары", country: "Россия", lat: 56.146, lon: 47.2511 },
            { name: "Тула", country: "Россия", lat: 54.193, lon: 37.6174 },
            { name: "Калининград", country: "Россия", lat: 54.7104, lon: 20.4522 },
            { name: "Брянск", country: "Россия", lat: 53.2434, lon: 34.3642 },
            { name: "Курск", country: "Россия", lat: 51.7304, lon: 36.1926 },
            { name: "Иваново", country: "Россия", lat: 57.0004, lon: 40.9739 },
            { name: "Магнитогорск", country: "Россия", lat: 53.3835, lon: 59.0314 },
            { name: "Тверь", country: "Россия", lat: 56.8587, lon: 35.9176 },
            { name: "Ставрополь", country: "Россия", lat: 45.0445, lon: 41.9691 },
            { name: "Белгород", country: "Россия", lat: 50.5977, lon: 36.5856 },
            { name: "Сочи", country: "Россия", lat: 43.5855, lon: 39.7231 },
            // Меньшие города и села
            { name: "Сергиев Посад", country: "Россия", lat: 56.3104, lon: 38.1337 },
            { name: "Суздаль", country: "Россия", lat: 56.4274, lon: 40.4487 },
            { name: "Плёс", country: "Россия", lat: 57.4604, lon: 41.5154 },
            { name: "Коломна", country: "Россия", lat: 55.0793, lon: 38.7783 },
            { name: "Звенигород", country: "Россия", lat: 55.7333, lon: 36.85 },
            { name: "Ростов Великий", country: "Россия", lat: 57.1847, lon: 39.4146 },
            { name: "Переславль-Залесский", country: "Россия", lat: 56.7392, lon: 38.856 },
            { name: "Александров", country: "Россия", lat: 56.3944, lon: 38.7144 },
            { name: "Гусь-Хрустальный", country: "Россия", lat: 55.619, lon: 40.651 },
            { name: "Киржач", country: "Россия", lat: 56.156, lon: 38.863 },
            // Другие страны
            { name: "Киев", country: "Украина", lat: 50.4501, lon: 30.5234 },
            { name: "Минск", country: "Беларусь", lat: 53.9045, lon: 27.5615 },
            { name: "Астана", country: "Казахстан", lat: 51.1605, lon: 71.4704 },
            { name: "Алматы", country: "Казахстан", lat: 43.222, lon: 76.8512 },
            { name: "Лондон", country: "Великобритания", lat: 51.5074, lon: -0.1278 },
            { name: "Париж", country: "Франция", lat: 48.8566, lon: 2.3522 },
            { name: "Берлин", country: "Германия", lat: 52.52, lon: 13.405 },
            { name: "Нью-Йорк", country: "США", lat: 40.7128, lon: -74.006 },
            { name: "Токио", country: "Япония", lat: 35.6762, lon: 139.6503 }
        ];

        // Автодополнение городов
        function initAutocomplete() {
            locationInput.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();

                if (query.length < 2) {
                    autocompleteResults.style.display = 'none';
                    return;
                }

                const filteredCities = cities.filter(city =>
                    city.name.toLowerCase().includes(query) ||
                    city.country.toLowerCase().includes(query) ||
                    `${city.name}, ${city.country}`.toLowerCase().includes(query)
                );

                if (filteredCities.length === 0) {
                    autocompleteResults.style.display = 'none';
                    return;
                }

                autocompleteResults.innerHTML = '';
                filteredCities.forEach(city => {
                    const item = document.createElement('div');
                    item.className = 'autocomplete-item';
                    item.innerHTML = `
                        <i class="fas fa-map-marker-alt"></i>
                        <div>
                            <div class="city-name">${city.name}</div>
                            <div class="country-name">${city.country}</div>
                        </div>
                    `;

                    item.addEventListener('click', () => {
                        locationInput.value = `${city.name}, ${city.country}`;
                        selectedCoords = {
                            lat: city.lat,
                            lon: city.lon,
                            name: `${city.name}, ${city.country}`
                        };
                        autocompleteResults.style.display = 'none';
                    });

                    autocompleteResults.appendChild(item);
                });

                autocompleteResults.style.display = 'block';
            });

            document.addEventListener('click', function(e) {
                if (!e.target.closest('.autocomplete-container')) {
                    autocompleteResults.style.display = 'none';
                }
            });

            locationInput.value = "Москва, Россия";
        }

        // Получение данных о погоде
        async function getWeatherData(lat, lon, date, time) {
            try {
                const targetDateTime = new Date(`${date}T${time}`);

                // Используем предоставленный API ключ
                const BASE_URL = 'https://api.openweathermap.org/data/2.5/forecast';
                const weatherUrl = `${BASE_URL}?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=ru`;

                const response = await fetch(weatherUrl);
                if (!response.ok) throw new Error('Ошибка получения данных о погоде');

                const data = await response.json();

                // Ищем ближайший прогноз
                let closestForecast = null;
                let minTimeDiff = Infinity;

                data.list.forEach(forecast => {
                    const forecastTime = new Date(forecast.dt * 1000);
                    const timeDiff = Math.abs(forecastTime - targetDateTime);

                    if (timeDiff < minTimeDiff) {
                        minTimeDiff = timeDiff;
                        closestForecast = forecast;
                    }
                });

                return {
                    forecast: closestForecast,
                    city: data.city.name,
                    country: data.city.country
                };

            } catch (error) {
                console.error('Ошибка:', error);
                // Резервные демо-данные
                return generateDemoWeatherData(lat, lon, date, time);
            }
        }

        // Генерация демо-данных (если API не работает)
        function generateDemoWeatherData(lat, lon, date, time) {
            const targetDate = new Date(`${date}T${time}`);
            const month = targetDate.getMonth();
            const hour = targetDate.getHours();

            let tempBase = 20;
            if (month >= 11 || month <= 1) tempBase = -5;
            else if (month >= 2 && month <= 4) tempBase = 10;
            else if (month >= 5 && month <= 7) tempBase = 25;
            else if (month >= 8 && month <= 10) tempBase = 15;

            if (hour >= 0 && hour < 6) tempBase -= 5;
            else if (hour >= 6 && hour < 12) tempBase += 2;
            else if (hour >= 12 && hour < 18) tempBase += 8;
            else if (hour >= 18 && hour < 24) tempBase += 3;

            const windSpeed = 3 + Math.random() * 10;
            const humidity = 40 + Math.random() * 50;
            const clouds = Math.random() * 100;
            const visibility = 5 + Math.random() * 15;

            let weatherType = "ясно";
            if (clouds > 70) weatherType = "облачно";
            if (clouds > 90 && humidity > 80) weatherType = "дождь";
            if (tempBase < 0 && humidity > 70) weatherType = "снег";

            return {
                forecast: {
                    main: {
                        temp: tempBase + (Math.random() * 6 - 3),
                        humidity: Math.round(humidity),
                        pressure: 1013 + Math.round(Math.random() * 20 - 10)
                    },
                    wind: {
                        speed: windSpeed,
                        deg: Math.round(Math.random() * 360)
                    },
                    clouds: {
                        all: Math.round(clouds)
                    },
                    visibility: visibility * 1000,
                    weather: [{
                        description: weatherType,
                        icon: weatherType === "ясно" ? "01d" :
                              weatherType === "облачно" ? "03d" :
                              weatherType === "дождь" ? "10d" : "13d"
                    }],
                    dt_txt: targetDate.toISOString()
                },
                city: selectedCoords.name.split(',')[0] || "Москва",
                country: selectedCoords.name.split(',')[1]?.trim() || "Россия"
            };
        }

        // Анализ условий для полета
        function analyzeFlightConditions(drone, weatherData) {
            const conditions = [];
            const weather = weatherData.forecast;

            // Ветер
            const windSpeed = weather.wind.speed;
            let windStatus = 'good';
            let windMessage = `Скорость ветра: ${windSpeed.toFixed(1)} м/с (допустимо: до ${drone.maxWind} м/с)`;

            if (windSpeed > drone.maxWind) {
                windStatus = 'bad';
                windMessage += ' - ПРЕВЫШЕНИЕ ЛИМИТА!';
            } else if (windSpeed > drone.windWarning) {
                windStatus = 'warning';
                windMessage += ' - Близко к пределу';
            }

            conditions.push({ name: 'Ветер', value: `${windSpeed.toFixed(1)} м/с`, status: windStatus, message: windMessage });

            // Осадки
            const rainDescription = weather.weather[0].description.toLowerCase();
            const isRaining = rainDescription.includes('дождь') || rainDescription.includes('снег');
            let rainStatus = 'good';
            let rainMessage = `Осадки: ${isRaining ? 'Да' : 'Нет'} (${rainDescription})`;

            if (isRaining && !drone.rainAllowed) {
                rainStatus = 'bad';
                rainMessage += ' - ПОЛЕТ ЗАПРЕЩЕН!';
            } else if (isRaining && drone.rainAllowed) {
                rainStatus = 'warning';
                rainMessage += ' - Осторожно, влажные условия';
            }

            conditions.push({ name: 'Осадки', value: isRaining ? 'Есть' : 'Нет', status: rainStatus, message: rainMessage });

            // Температура
            const temperature = weather.main.temp;
            let tempStatus = 'good';
            let tempMessage = `Температура: ${temperature.toFixed(1)}°C (допустимо: ${drone.minTemp}°C до ${drone.maxTemp}°C)`;

            if (temperature < drone.minTemp || temperature > drone.maxTemp) {
                tempStatus = 'bad';
                tempMessage += ' - ВНЕ ДИАПАЗОНА!';
            } else if (temperature < drone.minTemp + 5 || temperature > drone.maxTemp - 5) {
                tempStatus = 'warning';
                tempMessage += ' - Близко к пределу';
            }

            conditions.push({ name: 'Температура', value: `${temperature.toFixed(1)}°C`, status: tempStatus, message: tempMessage });

            // Видимость
            const visibility = weather.visibility / 1000;
            let visibilityStatus = 'good';
            let visibilityMessage = `Видимость: ${visibility.toFixed(1)} км (мин. требуется: ${drone.minVisibility/1000} км)`;

            if (visibility * 1000 < drone.minVisibility) {
                visibilityStatus = 'bad';
                visibilityMessage += ' - НИЖЕ МИНИМУМА!';
            } else if (visibility * 1000 < drone.minVisibility * 2) {
                visibilityStatus = 'warning';
                visibilityMessage += ' - Пониженная видимость';
            }

            conditions.push({ name: 'Видимость', value: `${visibility.toFixed(1)} км`, status: visibilityStatus, message: visibilityMessage });

            // Влажность
            const humidity = weather.main.humidity;
            let humidityStatus = 'good';
            let humidityMessage = `Влажность: ${humidity}%`;

            if (humidity > 90) {
                humidityStatus = 'warning';
                humidityMessage += ' - Высокая влажность может повлиять на электронику';
            } else if (humidity > 80) {
                humidityMessage += ' - Повышенная влажность';
            }

            conditions.push({ name: 'Влажность', value: `${humidity}%`, status: humidityStatus, message: humidityMessage });

            // Облачность
            const clouds = weather.clouds.all;
            let cloudsStatus = 'good';
            let cloudsMessage = `Облачность: ${clouds}%`;

            if (clouds > 80) {
                cloudsStatus = 'warning';
                cloudsMessage += ' - Плотная облачность, возможны проблемы с GPS';
            } else if (clouds > 50) {
                cloudsMessage += ' - Умеренная облачность';
            }

            conditions.push({ name: 'Облачность', value: `${clouds}%`, status: cloudsStatus, message: cloudsMessage });

            // Общий статус
            let overallStatus = 'excellent';
            let statusText = '';
            let statusClass = 'status-excellent';

            const badConditions = conditions.filter(c => c.status === 'bad').length;
            const warningConditions = conditions.filter(c => c.status === 'warning').length;

            if (badConditions > 0) {
                overallStatus = 'bad';
                statusText = 'ПОЛЕТ НЕ РЕКОМЕНДУЕТСЯ';
                statusClass = 'status-bad';
            } else if (warningConditions >= 2) {
                overallStatus = 'moderate';
                statusText = 'ПОЛЕТ С ОГРАНИЧЕНИЯМИ';
                statusClass = 'status-moderate';
            } else if (warningConditions === 1) {
                overallStatus = 'good';
                statusText = 'ПОЛЕТ ВОЗМОЖЕН С ОСТОРОЖНОСТЬЮ';
                statusClass = 'status-good';
            } else {
                overallStatus = 'excellent';
                statusText = 'ОТЛИЧНЫЕ УСЛОВИЯ ДЛЯ ПОЛЕТА';
                statusClass = 'status-excellent';
            }

            // Рекомендации
            const recommendations = generateRecommendations(drone, conditions, overallStatus);

            return { conditions, overallStatus, statusText, statusClass, weather, recommendations };
        }

        // Генерация рекомендаций
        function generateRecommendations(drone, conditions, overallStatus) {
            let recommendations = [];

            if (overallStatus === 'excellent') {
                recommendations.push("Идеальные условия для полета. Можете летать без ограничений.");
                recommendations.push("Рекомендуется использовать все доступные функции дрона.");
            } else if (overallStatus === 'good') {
                recommendations.push("Хорошие условия для полета. Будьте внимательны к изменению погоды.");
                recommendations.push("Проверьте батарею и убедитесь, что дрон правильно калиброван.");
            } else if (overallStatus === 'moderate') {
                recommendations.push("Условия требуют повышенной осторожности.");
                recommendations.push("Рекомендуется летать на меньшей высоте и ближе к оператору.");
                recommendations.push("Избегайте сложных маневров и полетов над водой.");
            } else {
                recommendations.push("Полет не рекомендуется. Дождитесь улучшения погодных условий.");
                recommendations.push("Если необходимо лететь, используйте дрон с защитой от осадков.");
                recommendations.push("Рассмотрите возможность переноса полета на другое время.");
            }

            const windCondition = conditions.find(c => c.name === 'Ветер');
            if (windCondition && windCondition.status === 'warning') {
                recommendations.push("При сильном ветре летайте против ветра на вылете и по ветру на возврате.");
            }

            const rainCondition = conditions.find(c => c.name === 'Осадки');
            if (rainCondition && rainCondition.status !== 'good') {
                recommendations.push("После полета в условиях повышенной влажности тщательно просушите дрон.");
            }

            return recommendations;
        }

        // Отображение результатов
        function displayResults(drone, analysis, weatherData) {
            weatherResult.style.display = 'block';
            noResultElement.style.display = 'none';

            if (window.innerWidth <= 768) {
                switchTab('results');
            }

            // Статус полета
            flightStatus.className = `flight-status ${analysis.statusClass}`;
            flightStatus.innerHTML = `
                <div>${analysis.statusText}</div>
                <div style="font-size: 0.9rem; margin-top: 5px; opacity: 0.9;">
                    ${weatherData.city}, ${weatherData.country} | ${formatDateTime(weatherData.forecast.dt_txt)}
                </div>
            `;

            // Детали погоды
            const weather = weatherData.forecast;
            weatherDetails.innerHTML = `
                <div class="weather-item">
                    <div class="weather-icon"><i class="fas fa-temperature-high"></i></div>
                    <div class="weather-value">${weather.main.temp.toFixed(1)}°C</div>
                    <div class="weather-label">Температура</div>
                </div>
                <div class="weather-item">
                    <div class="weather-icon"><i class="fas fa-wind"></i></div>
                    <div class="weather-value">${weather.wind.speed.toFixed(1)} м/с</div>
                    <div class="weather-label">Ветер</div>
                </div>
                <div class="weather-item">
                    <div class="weather-icon"><i class="fas fa-tint"></i></div>
                    <div class="weather-value">${weather.main.humidity}%</div>
                    <div class="weather-label">Влажность</div>
                </div>
                <div class="weather-item">
                    <div class="weather-icon"><i class="fas fa-cloud"></i></div>
                    <div class="weather-value">${weather.clouds.all}%</div>
                    <div class="weather-label">Облачность</div>
                </div>
            `;

            // Условия
            conditionsList.innerHTML = '';
            analysis.conditions.forEach(condition => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <div style="flex: 1;">
                        <strong>${condition.name}</strong><br>
                        <small style="font-size: 0.8rem; color: #666;">${condition.message}</small>
                    </div>
                    <div>
                        <span class="condition-status condition-${condition.status}">${condition.value}</span>
                    </div>
                `;
                conditionsList.appendChild(li);
            });

            // Рекомендации
            recommendationsElement.innerHTML = '';
            analysis.recommendations.forEach(rec => {
                const p = document.createElement('p');
                p.textContent = `• ${rec}`;
                p.style.marginBottom = '5px';
                recommendationsElement.appendChild(p);
            });
        }

        // Форматирование даты и времени
        function formatDateTime(dateTimeString) {
            const date = new Date(dateTimeString);
            const options = {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return date.toLocaleDateString('ru-RU', options);
        }

        // Переключение вкладок
        function switchTab(tabName) {
            tabBtns.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabName);
            });
            tabContents.forEach(content => {
                content.classList.toggle('active', content.id === `${tabName}-tab`);
            });
        }

        // Обработчик проверки погоды
        async function handleCheckWeather() {
            const drone = selectedDrone;
            const date = dateInput.value;
            const time = timeInput.value;

            if (!date || !time) {
                alert('Пожалуйста, выберите дату и время');
                return;
            }

            loadingElement.style.display = 'block';
            weatherResult.style.display = 'none';
            noResultElement.style.display = 'none';

            setTimeout(async () => {
                try {
                    const weatherData = await getWeatherData(
                        selectedCoords.lat,
                        selectedCoords.lon,
                        date,
                        time
                    );
                    const analysis = analyzeFlightConditions(drone, weatherData);
                    displayResults(drone, analysis, weatherData);
                } catch (error) {
                    alert(`Ошибка: ${error.message}. Пожалуйста, попробуйте снова.`);
                    console.error(error);
                } finally {
                    loadingElement.style.display = 'none';
                }
            }, 800);
        }

        // Инициализация приложения
        function initApp() {
            setCurrentDateTime();
            initDroneSelect();
            initAutocomplete();

            // Обработчики событий
            checkWeatherBtn.addEventListener('click', handleCheckWeather);
            locationInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleCheckWeather();
            });

            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.dataset.tab));
            });

            // Пример анализа при загрузке на десктопе
            if (window.innerWidth > 768) {
                setTimeout(() => handleCheckWeather(), 500);
            }
        }

        // Запуск приложения
        document.addEventListener('DOMContentLoaded', initApp);

        // Обработчик изменения размера окна
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                tabContents.forEach(content => content.classList.add('active'));
            }
        });
    </script>
</body>
</html>
